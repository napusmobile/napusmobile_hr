<div class="row g-3 mt-2">
  <div class="col-md-4">
    <div class="card border-0 shadow-sm mb-2">
      <div class="card-header bg-white">
        <div class="row">
          <div class="col-12 col-md-4 mb-2 mb-md-0">üíπ Dashboard</div>
        </div>
      </div>
      <div class="card-body rounded-4">
        <ul class="box-info">
          <li>
            <i class="fa-solid fa-sack-dollar"></i>
            <span class="text">
              <p>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>
              <h3 id="countingSalaryA">0 <span style="font-size: 12px">(‡∏ö‡∏≤‡∏ó)</span></h3>                
            </span>
          </li>
          <li>
            <i class="fa-solid fa-landmark"></i>
            <span class="text">
              <p>‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p>
              <h3 id="countingSalaryB">0 <span style="font-size: 12px">(‡∏ö‡∏≤‡∏ó)</span></h3>                
            </span>
          </li>
          <li>
            <i class="fa-solid fa-user-doctor"></i>
            <span class="text">
              <p>‡∏£‡∏ß‡∏°‡∏´‡∏±‡∏Å‡∏•‡∏≤</p>
              <h3 id="countingSalaryC">0 <span style="font-size: 12px">(‡∏ö‡∏≤‡∏ó)</span></h3>        
            </span>
          </li>
          <li>
            <i class="fa-solid fa-user-shield"></i>
            <span class="text">
              <p>‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°</p>
              <h3 id="countingSalaryD">0 <span style="font-size: 12px">(‡∏ö‡∏≤‡∏ó)</span></h3>               
            </span>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white">
        <div class="row g-3">
          <div class="col-12 col-md-12 mb-2 mb-md-0">üíπ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
        </div>
      </div>
        <div class="card-body rounded-4">
          <div id="chartSalary" style="width: 100%; height: 200px;"></div>
        </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white">
        <div class="row g-3">
          <div class="col-12 col-md-12 mb-2 mb-md-0">üíπ ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢</div>
        </div>
      </div>
        <div class="card-body rounded-4">
          <div id="chartSummary" style="width: 100%; height: 200px;"></div>
        </div>
    </div>
  </div>
</div>

<div class="row g-3 mt-1">
  <div class="col-md-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white">
        <div class="row">
          <div class="col-12 col-md-4 mb-2 mb-md-0">üèõÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏™‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
          <div class="col-12 col-md-8 d-flex flex-wrap justify-content-md-end">
            <select class="form-control float-sm-end me-2 mb-2 mb-md-0" style="width: auto;" onchange="updateItemsSummary(this.value)">
              <option value="10">‚úÖ 10</option>
              <option value="20">‚úÖ 25</option>
              <option value="50">‚úÖ 50</option>
              <option value="100">‚úÖ 100</option>
              <option value="all">‚úÖ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            </select>
            <input type="search" class="form-control float-sm-end me-2 mb-2 mb-md-0" style="width: auto;" id="searchSummary" placeholder="üîç‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•..." oninput="filterSummary()">
          </div>
        </div>

      </div>
      <div class="card-body rounded-4">
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th scope="col" class="text-center">‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà</th>
                <th scope="col" class="text-center">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                <th scope="col" class="text-center">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞</th>
                <th scope="col" class="text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
                <th scope="col" class="text-center">‡∏£‡∏ß‡∏°‡∏´‡∏±‡∏Å‡∏™‡∏≤‡∏¢</th>
                <th scope="col" class="text-center">‡∏£‡∏ß‡∏°‡∏´‡∏±‡∏Å‡∏•‡∏≤</th>
                <th scope="col" class="text-center">‡∏£‡∏ß‡∏°‡∏´‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°</th>
                <th scope="col" class="text-center">‡∏£‡∏ß‡∏°‡∏´‡∏±‡∏Å‡∏≠‡∏∑‡πà‡∏ô</th>
                <th scope="col" class="text-center">‡∏£‡∏ß‡∏°OT</th>
                <th scope="col" class="text-center">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</th>
                <th scope="col" class="text-center">‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
                <th scope="col" class="text-center">‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th>
                <th scope="col" class="text-center">Action</th>
              </tr>
            </thead>
            <tbody id="tableDataSummary">
              <tr>
                <td colspan='13' class='fw-bold text-danger text-center p-4'><i class='fa-solid fa-circle-info text-danger'></i> ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•! üòì</td>
              </tr>
            </tbody>       
          </table>
        </div>
        <div class="row mt-1">
          <div class="col-12 col-md-6 mb-2 mb-md-0 align-items-center" id="paginationSummaryInfo"></div>
          <div class="col-12 col-md-6 d-flex justify-content-md-end align-items-center">
            <div id="paginationSummary" class="pagination"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let filteredSummary = [];
let currentSummary = 1;
let itemsPerSummary = 10;

const renderSummary = (res) => {
  const table = document.getElementById('tableDataSummary');
  table.innerHTML = '';

  res.sort((a, b) => {
    const dateA = new Date(a[4].split('/').reverse().join('/'));
    const dateB = new Date(b[4].split('/').reverse().join('/'));
    return dateB - dateA;
  });

  const startIndex = (currentSummary - 1) * itemsPerSummary;
  const endIndex = startIndex + itemsPerSummary;
  const emp = res.slice(startIndex, endIndex);

  const startRow = startIndex + 1;
  const endRow = startIndex + emp.length;
  const totalRows = res.length;

  document.getElementById('paginationSummaryInfo').innerText = `‡πÅ‡∏™‡∏î‡∏á ${startRow} ‡∏ñ‡∏∂‡∏á ${endRow} ‡∏à‡∏≤‡∏Å ${totalRows} ‡πÅ‡∏ñ‡∏ß`;

  if (emp.length === 0) {
    const row = table.insertRow();
    row.innerHTML = `<td colspan='13' class='fw-bold text-danger text-center p-4'><i class='fa-solid fa-circle-info text-danger'></i> ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•! üòì</td>`;
    return;
  }

  emp.forEach((rowIndex) => {
    const details = JSON.parse(rowIndex[5]);
    const employeeCount = details.length;
    var row = table.insertRow();
    row.innerHTML = `
      <td class="text-center"><span style="font-size: 14px;">${rowIndex[1]}</span></td>
      <td class="text-center"><span style="font-size: 14px;">${rowIndex[3]}</span></td>
      <td class="text-center"><span style="font-size: 14px;">${rowIndex[4]}</span></td>
      <td class="text-center"><span style="font-size: 14px;">üôç‚Äç‚ôÇÔ∏è <span style="color: var(--box1);">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${employeeCount} ‡∏Ñ‡∏ô</span></span></td>
      <td class="text-center"><span style="font-size: 14px;color: var(--box4);"><i class="fa-solid fa-circle-arrow-down"></i> ${rowIndex[6]} ‡∏ö‡∏≤‡∏ó</span></td>
      <td class="text-center"><span style="font-size: 14px;color: var(--box4);"><i class="fa-solid fa-circle-arrow-down"></i> ${rowIndex[7]} ‡∏ö‡∏≤‡∏ó</span></td>
      <td class="text-center"><span style="font-size: 14px;color: var(--box4);"><i class="fa-solid fa-circle-arrow-down"></i> ${rowIndex[9]} ‡∏ö‡∏≤‡∏ó</span></td>
      <td class="text-center"><span style="font-size: 14px;color: var(--box4);"><i class="fa-solid fa-circle-arrow-down"></i> ${rowIndex[10]} ‡∏ö‡∏≤‡∏ó</span></td>
      <td class="text-center"><span style="font-size: 14px;color: var(--box2);"><i class="fa-solid fa-circle-arrow-up"></i> ${rowIndex[8]} ‡∏ö‡∏≤‡∏ó</span></td>
      <td class="text-center"><span style="font-size: 14px;color: var(--box2);""><i class="fa-solid fa-circle-arrow-up"></i> ${rowIndex[11]} ‡∏ö‡∏≤‡∏ó</span></td>
      <td class="text-center"><span style="font-size: 14px;color: var(--box3);"">üôç‚Äç‚ôÇÔ∏è ${rowIndex[12]} ‡∏ö‡∏≤‡∏ó</span></td>
      <td class="text-center"><span style="font-size: 14px;color: var(--box2);""><i class="fa-solid fa-sack-dollar"></i> ${rowIndex[13]} ‡∏ö‡∏≤‡∏ó</span></td>
      <td class="text-center">
        <div style="display: flex; justify-content: center;">
          <select class="form-control me-2" style="font-size: 14px; width: auto;" disabled>
            <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${rowIndex[2] === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ? 'selected' : ''}>‚åõ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
            <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" ${rowIndex[2] === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£' ? 'selected' : ''}>‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
            <option value="‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß" ${rowIndex[2] === '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
          </select>
          <div class="dropdown">
            <button class="btn btn-sm del-button dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fa-solid fa-ellipsis"></i>
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item hover-highlight" onclick="editSummary('${rowIndex[0]}')"><i class="fa-solid fa-pen-to-square"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</a></li>
              <li><a class="dropdown-item hover-highlight" onclick="sendSummary('${rowIndex[0]}')"><i class="fa-solid fa-building-columns"></i> ‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a></li>
              <li><a class="dropdown-item hover-highlight" onclick="sendPayslip('${rowIndex[0]}')"><i class="fa-regular fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏™‡∏•‡∏µ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a></li>
              <li><a class="dropdown-item hover-highlight" onclick="sendExcel('${rowIndex[0]}')"><i class="fa-regular fa-file-excel"></i> Download Excel</a></li>
              <li><a class="dropdown-item hover-highlight" onclick="delSummary('${rowIndex[0]}')"><i class="fa-solid fa-trash-can"></i> ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</a></li>
            </ul>
          </div>
        </div>
      </td>
    `;
  });
}

const renderPageSummary = (totalItems) => {
  const totalPages = Math.ceil(totalItems / itemsPerSummary);
  const paginationContainer = document.getElementById('paginationSummary');
  paginationContainer.innerHTML = '';
  if (totalPages > 1) {
    const createPageButton = (text, page, isDisabled = false, isActive = false) => {
      const li = document.createElement('li');
      li.className = `page-item ${isDisabled ? 'disabled' : ''} ${isActive ? 'active' : ''}`;
      const button = document.createElement('button');
      button.className = 'page-link';
      button.innerText = text;
      button.onclick = () => {
        if (!isDisabled) {
        currentSummary = page;
        renderSummary(allSummary);
        renderPageSummary(allSummary.length);
        }
      };
      li.appendChild(button);
      return li;
    };
    paginationContainer.appendChild(createPageButton('‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö', currentSummary - 1, currentSummary === 1));

    if (currentSummary > 2) {
      paginationContainer.appendChild(createPageButton(1, 1, false, currentSummary === 1));
      if (currentSummary > 3) {
        const ellipsis = document.createElement('li');
        ellipsis.className = 'page-item disabled';
        ellipsis.innerHTML = '<span class="page-link">...</span>';
        paginationContainer.appendChild(ellipsis);
      }
    }
    paginationContainer.appendChild(createPageButton(currentSummary, currentSummary, false, true));

    if (currentSummary < totalPages - 1) {
      if (currentSummary < totalPages - 2) {
        const ellipsis = document.createElement('li');
        ellipsis.className = 'page-item disabled';
        ellipsis.innerHTML = '<span class="page-link">...</span>';
        paginationContainer.appendChild(ellipsis);
      }
      paginationContainer.appendChild(createPageButton(totalPages, totalPages, false, currentSummary === totalPages));
    }
    paginationContainer.appendChild(createPageButton('‡∏ñ‡∏±‡∏î‡πÑ‡∏õ', currentSummary + 1, currentSummary === totalPages));
  }
}

const filterSummary = () => {
  const query = document.getElementById('searchSummary').value.toLowerCase();
  filteredSummary = allSummary.filter(row => {
    return row.some(column => column.toLowerCase().includes(query));
  });

  currentSummary = 1;
  renderSummary(filteredSummary);
  renderPageSummary(filteredSummary.length);
}

const updateItemsSummary = (value) => {
  if (value === "all") {
    itemsPerSummary = filteredSummary.length;
  } else {
    itemsPerSummary = parseInt(value, 10);
  }

  currentSummary = 1;
  renderSummary(filteredSummary);
  renderPageSummary(filteredSummary.length);
}

const editSummary = (codeID) => {
  const summaryData = allSummary.find(summary => summary[0] === codeID);

  if (!summaryData) {
    createToast("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç", 3);
    return;
  }

  const editMode = true;
  const period = summaryData[1]; // ‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà
  const paymentDate = summaryData[4]; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞
  const totalDow = parseFloat(summaryData[10].replace(/,/g, '')) || 0;  // ‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏î
  const totalAdj = parseFloat(summaryData[11].replace(/,/g, '')) || 0;  // ‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°
  const salaryBefore = parseFloat(summaryData[12].replace(/,/g, '')) || 0;  // ‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
  const salaryAfter = parseFloat(summaryData[13].replace(/,/g, '')) || 0;  // ‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥

  const selectPeriod = document.getElementById('selectPeriod');
  const periodOption = Array.from(selectPeriod.options).find(option => option.text.includes(period));
  if (periodOption) {
    selectPeriod.value = periodOption.value;
  }

  document.getElementById('dataSalary').value = paymentDate.split('/').reverse().join('-');
  document.getElementById('dataSalaryKey').value = codeID;

  document.getElementById('salaryBefore').textContent = salaryBefore.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  document.getElementById('salaryAfter').textContent = salaryAfter.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  document.getElementById('totalAdj').textContent = totalAdj.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  document.getElementById('totalDow').textContent = totalDow.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');

  changePage(4);
  renderSalaryData(editMode, codeID);
};

const delSummary = (codeID) => {
  let rowIndex = allSummary.find(row => row[0] === codeID);
  if (rowIndex) {
    $('#confirmBtnDel').off('click').on('click', function() {
      $.LoadingOverlay("show", { image: "", fontawesome: "fa fa-spinner fa-spin" });
      $('#DelDataModal').modal('hide');
      google.script.run.withSuccessHandler(async (res) => {
        rowIndex = allSummary.filter(row => row[0] !== codeID);
        $.LoadingOverlay("hide");
        await updateSpecificSummaryData();
        createToast("‚õî ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", 0);
      }).delDataSummary(codeID);
    });
    $('#xDelconfirmData').off('click').on('click', function() {
      $('#DelDataModal').modal('hide');
    });
    $('#DelDataModal').modal('show');
  }
}

let selectedBankCodeID = null;

const sendSummary = (codeID) => {
  selectedBankCodeID = codeID;
  openBankSelectModal();
};

const sendSummaryBankCode = (codeID, bankCode) => {
  const summaryData = allSummary.find(summary => summary[0] === codeID);

  if (!summaryData) {
    createToast("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", 3);
    return;
  }

  try {
    let employeeDetails = JSON.parse(summaryData[5]);
    let textFileContent = '';

    employeeDetails.forEach(employee => {
      let uidUser = employee.uidUser.replace("‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ", "");
      let userData = dataUsers && dataUsers.find(user => user[0] === uidUser);
      
      if (userData) {
        let bankAccount = userData[25]; // ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
        let citizenId = userData[12]; // ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô
        let fullName = employee["fullName"].replace("‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•: ", ""); // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°
        let totalIncome = employee["totalIncome"]; // ‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ
        let email = userData[30]; // Email
        let mobile = userData[32]; // ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
        textFileContent += `${bankCode} ${bankAccount} ${citizenId} ${fullName} ${totalIncome} ${email} ${mobile}\n`;
      } else {
        createToast("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UID", 0);
      }
    });

    const blob = new Blob([textFileContent], { type: 'text/plain' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'HRCloud-Epic Coding Channel.txt';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    createToast("‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå .txt ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", 1);

    google.script.run
      .withSuccessHandler(async (res) => {
        await updateSpecificSummaryData();
        createToast("‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", 1);
      })
      .withFailureHandler(async (res) => {
        await updateSpecificSummaryData();
        createToast("‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", 0);
      })
      .updatebankCode(codeID, "‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß");

  } catch (e) {
    createToast("‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", 0);
    console.error(e);
  }
};

const sendExcel = (codeID) => {
  const summaryData = allSummary.find(summary => summary[0] === codeID);

  if (!summaryData) {
    createToast("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", 0);
    return;
  }

  try {
    let employeeDetails = JSON.parse(summaryData[5]);

    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const tbody = document.createElement('tbody');

    // ‡πÅ‡∏ñ‡∏ß‡∏ú‡∏™‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
    const mergedRow = document.createElement('tr');
    const mergedCell = document.createElement('td');
    mergedCell.colSpan = 20;  // ‡∏ú‡∏™‡∏≤‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)
    mergedCell.textContent = '‡∏á‡∏ß‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ' + summaryData[1] + ' | ‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ' + summaryData[12] + ' | ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°: ' + summaryData[13];
    mergedCell.style.fontWeight = 'bold';  // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤
    mergedRow.appendChild(mergedCell);
    thead.appendChild(mergedRow);  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡∏ú‡∏™‡∏≤‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà thead

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    const headers = [
      "‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô", "‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•", "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á", "‡πÅ‡∏ú‡∏ô‡∏Å", "‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô", 
      "‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", "‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©", "‡∏™‡∏≤‡∏¢‡∏£‡∏ß‡∏°", "‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢", "‡∏•‡∏≤‡∏Å‡∏¥‡∏à", 
      "‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô", "‡∏•‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ", "‡∏´‡∏±‡∏Å‡∏™‡∏≤‡∏¢", "‡∏´‡∏±‡∏Å‡∏•‡∏≤", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô OT", 
      "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ OT", "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô‡πÜ", "‡∏´‡∏±‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ", "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°", "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°"
    ];

    const headerRow = document.createElement('tr');
    headers.forEach(header => {
      const th = document.createElement('th');
      th.textContent = header;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    employeeDetails.forEach(employee => {
      const row = document.createElement('tr');
      let uidUser = employee.uidUser.replace("‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ", "");
      let userData = dataUsers && dataUsers.find(user => user[0] === uidUser);
      let citizenId = userData ? "'" + userData[12].toString() : "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";

      const cells = [
        uidUser,
        employee["fullName"].replace("‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•: ", ""),
        employee["department"].replace("‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ", ""),
        employee["group"].replace("‡πÅ‡∏ú‡∏ô‡∏Å: ", ""),
        citizenId,
        employee["salary"],
        employee["specialAllowance"],
        employee["lateHours"],
        employee["sickLeave"],
        employee["personalLeave"],
        employee["vacationLeave"],
        employee["otherLeave"],
        employee["lateDeductions"],
        employee["leaveDeductions"],
        employee["otHours"],
        employee["otIncome"],
        employee["otherIncome"],
        employee["otherDeductions"],
        employee["socialSecurity"],
        employee["totalIncome"]
      ];
      cells.forEach(cellContent => {
        const td = document.createElement('td');
        td.textContent = cellContent;
        row.appendChild(td);
      });
      tbody.appendChild(row);
    });

    table.appendChild(thead);
    table.appendChild(tbody);

    const workbook = XLSX.utils.table_to_book(table, { sheet: "Employee Summary" });
    XLSX.writeFile(workbook, 'HRCloud-Epic Coding Channel.xlsx');

  } catch (e) {
    createToast("‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", 0);
    console.error(e);
  }
};

const sendPayslip = (codeID) => {
  const summaryData = allSummary.find(summary => summary[0] === codeID);

  if (!summaryData) {
    createToast("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", 0);
    return;
  }

  let employeeDetails = JSON.parse(summaryData[5]);
  let totalEmployees = employeeDetails.length; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  let emailsSent = 0; // ‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

  employeeDetails.forEach(employee => {
    let uidUser = employee.uidUser.replace("‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ", "");
    let userData = dataUsers && dataUsers.find(user => user[0] === uidUser);

    if (userData) {
      let email = userData[30];

      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏™‡∏∞‡∏™‡∏°
      let retainedIncome = allSummary
        .filter(s => JSON.parse(s[5]).some(e => e.uidUser.includes(uidUser)))
        .reduce((total, s) => total + JSON.parse(s[5])
          .filter(e => e.uidUser.includes(uidUser))
          .reduce((sum, e) => sum + e.totalIncome, 0), 0);

      let retainedSocialSecurity = allSummary
        .filter(s => JSON.parse(s[5]).some(e => e.uidUser.includes(uidUser)))
        .reduce((total, s) => total + JSON.parse(s[5])
          .filter(e => e.uidUser.includes(uidUser))
          .reduce((sum, e) => sum + e.socialSecurity, 0), 0);

      let payrollData = {
        fullname: employee["fullName"].replace("‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•: ", ""),
        uid: uidUser,
        department: employee["department"].replace("‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ", ""),
        group: employee["group"].replace("‡πÅ‡∏ú‡∏ô‡∏Å: ", ""),
        paymentPeriod: summaryData[1],
        paymentDate: summaryData[4],
        accountbank: userData[25],
        paysalary: employee["salary"],
        payspecial: employee["specialAllowance"],
        overtime: employee["otIncome"],
        socialSecurity: employee["socialSecurity"],
        commission: employee["otherIncome"],
        absentDeduction: employee["lateDeductions"] + employee["leaveDeductions"],
        otherDeduction: employee["otherDeductions"],
        totalpaysalary: employee["totalIncome"],
        adjustments: employee["salary"] + employee["specialAllowance"] + employee["otIncome"] + employee["otherIncome"],
        deductions: employee["lateDeductions"] + employee["leaveDeductions"] + employee["otherDeductions"] + employee["socialSecurity"],
        retainedIncome: retainedIncome,
        retainedSocialSecurity: retainedSocialSecurity
      };

      createPayroll(payrollData, (base64PDF) => {
        google.script.run.withSuccessHandler((res) => {
          emailsSent++; 
          if (emailsSent === totalEmployees) {
            createToast("‚úÖ ‡∏™‡πà‡∏á PaySlip ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", 1);
          }
        }).sendPayrollEmail(email, { ...payrollData, base64: base64PDF });
      });
    } else {
      createToast(`‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UID: ${uidUser}`, 0);
    }
  });
};

const formatCountsSalary = (num) => {
  if (num >= 1000000) {
    return (num / 1000000).toFixed(2) + 'M';
  } else if (num >= 1000) {
    return (num / 1000).toFixed(2) + 'K';
  } else {
    return num.toLocaleString();
  }
}

const updateCountsSalary = (data) => { 
  const countingSalaryA = data.reduce((sum, item) => 
    sum + (parseFloat(item[12].replace(/,/g, '')) || 0), 0);
  const countingSalaryB = data.reduce((sum, item) => 
    sum + (parseFloat(item[13].replace(/,/g, '')) || 0), 0);
  const countingSalaryC = data.reduce((sum, item) => 
    sum + (parseFloat(item[7].replace(/,/g, '')) || 0), 0);
  const countingSalaryD = data.reduce((sum, item) => 
    sum + (parseFloat(item[9].replace(/,/g, '')) || 0), 0);

  document.getElementById('countingSalaryA').innerText = formatCountsSalary(countingSalaryA.toFixed(2));
  document.getElementById('countingSalaryB').innerText = formatCountsSalary(countingSalaryB.toFixed(2));
  document.getElementById('countingSalaryC').innerText = formatCountsSalary(countingSalaryC.toFixed(2));
  document.getElementById('countingSalaryD').innerText = formatCountsSalary(countingSalaryD.toFixed(2));
}

const insertChartSalary = (data) => { 
  const checkChart1 = document.querySelector("#chartSalary").querySelector('.apexcharts-canvas');
  const checkChart2 = document.querySelector("#chartSummary").querySelector('.apexcharts-canvas');
  if (checkChart1) {
    checkChart1.remove();
  }
  if (checkChart2) {
    checkChart2.remove();
  }

  let monthlyTotalIncome = new Map();
  const monthNames = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];
  const colors = ['#3c8cf3', '#05be8a', '#745af2', '#ef5350', '#ffca28', '#8e44ad', '#3498db', '#1abc9c', '#e74c3c', '#f39c12', '#d35400', '#2ecc71'];

  data.forEach((item) => {
    if (item[4] && item[13]) {
      const parts = item[4].split("/"); // ‡πÅ‡∏¢‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ
      const dueDate = new Date(parts[2], parts[1] - 1, parts[0]); // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
      const month = dueDate.getMonth(); // ‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
      const monthName = monthNames[month];

      const totalIncome = parseFloat(item[13].replace(/,/g, '')) || 0; // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ

      if (monthlyTotalIncome.has(monthName)) {
        monthlyTotalIncome.set(monthName, monthlyTotalIncome.get(monthName) + totalIncome);
      } else {
        monthlyTotalIncome.set(monthName, totalIncome);
      }
    }
  });

  let totalIncomeAllMonths = Array.from(monthlyTotalIncome.values()).reduce((acc, val) => acc + val, 0); // ‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  let seriesData = monthNames.map(month => monthlyTotalIncome.get(month) || 0);

  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  let percentageData = seriesData.map(val => ((val / totalIncomeAllMonths) * 100).toFixed(2)); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡πá‡∏ô % ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô string

  // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤ % ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Pie Chart ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ
  let percentageDataNumbers = percentageData.map(val => parseFloat(val));

  // ‡∏Å‡∏£‡∏≤‡∏ü Bar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°
  var optionsBar = {
    series: [{
      name: '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°',
      data: seriesData.map(val => val.toFixed(2))
    }],
    chart: {
      height: 260,
      type: 'bar',
      events: {
        click: function(chart, w, e) {
          // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≤‡∏ü
        }
      }
    },
    colors: colors,
    plotOptions: {
      bar: {
        columnWidth: '45%',
        distributed: true,
      }
    },
    dataLabels: {
      enabled: false
    },
    legend: {
      show: false
    },
    xaxis: {
      categories: monthNames,
      labels: {
        style: {
          colors: colors,
          fontSize: '12px',
          fontFamily: 'Prompt, sans-serif'
        }
      }
    }
  };

  const chartBar = new ApexCharts(document.querySelector("#chartSalary"), optionsBar);
  chartBar.render();

  // ‡∏Å‡∏£‡∏≤‡∏ü Pie ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  var optionsPie = {
    series: percentageDataNumbers, // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏õ‡∏•‡∏á
    chart: {
      height: 270,
      type: 'pie',
    },
    colors: colors, // ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ
    labels: monthNames, // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏Å‡∏£‡∏≤‡∏ü
    legend: {
      position: 'right',  // ‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á legend ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤
      horizontalAlign: 'center', // ‡∏à‡∏±‡∏î‡∏ä‡∏¥‡∏î‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á
      floating: false
    },
    dataLabels: {
      enabled: true,
      formatter: function (val) {
        return val.toFixed(2) + '%';
      }
    },
    tooltip: {
      y: {
        formatter: function (val) {
          return val.toFixed(2) + '%';
        }
      }
    }
  };

  const chartPie = new ApexCharts(document.querySelector("#chartSummary"), optionsPie);
  chartPie.render();
};
</script>
